<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<title>Test</title>
<script src="https://cdn.c360a.salesforce.com/beacon/c360a/3f269d46-d5af-41f1-9662-6af0ee55b31c/scripts/c360a.min.js"> </script>
    <script>
      
        SalesforceInteractions.init({
          consents: [
            {
              provider: "Test Provider", 
              purpose: "Tracking",
              status: SalesforceInteractions.ConsentStatus.OptIn,
            },
          ],
        }).then(()=>{
          console.log('init');
        });
        console.log(window);
    </script>
</head>

<body>
	<table id="table">
	</table>
	<br>
	<br>

	<label for="">Account Name</label>
	<input type="text" id="Name">
	<br>

	<button onclick="createNewAccount()">Submit me</button> 
</body>
<script>
	// Salesforce REST API Endpoint
	const apiEndpoint = 'https://orgfarm-1ad1efddcb-dev-ed.develop.my.salesforce.com/services/apexrest/accounts/';

	// Authentication Token (OAuth token from Salesforce authentication) 
	const accessToken = '00DgK000001W5yE!AQEAQGSFhUm1ibF.sU8tq6kH2Qovb0aOSdtYYv_GficLH1gVJ4sfwbjmbG4_EovKTFcFlMRH70go6iqo7FJPbmXT8W09FOK6';

	// Function to call the Apex REST API and fetch Accounts
	function getAllAccounts() {
		// Create the headers object with Authorization Bearer token
		const headers = {
			'Authorization': `Bearer ${accessToken}`,
			'Content-Type': 'application/json'
		};

		// Fetch data from the Salesforce API
		fetch(apiEndpoint, {
			method: 'GET',
			headers: headers
		})
		.then(response => response.json())  // Convert response to JSON
		.then(data => {
			// Handle success and process the data (Accounts)
			console.log('Accounts retrieved:', data);
			if (data.length > 0){
				for (let i = 0; i < data.length; i++){
					const account = data[i];
					var table = document.getElementById("table");
					var row = table.insertRow(0); 
					var cell1 = row.insertCell(0);
					var cell2 = row.insertCell(1);
					var cell3 = row.insertCell(2);
					cell1.innerHTML = account.Name;
					cell2.innerHTML = account.Industry;
					cell3.innerHTML = account.Type;
				}
			}
		})
		.catch(error => {
			// Handle any errors
			console.error('Error fetching Accounts:', error);
		});
	}

// Call the function to retrieve the Accounts
getAllAccounts();	

function createNewAccount() {
	var name = document.getElementById("Name").value;
	if (name == "" || name == null || name == undefined || name == NaN){
		alert("Please enter a name");
		return;
	}
	console.log(name)
	const newAccountData = {
		"Name": name,
		"Industry": "Technology",
		"Type": "Prospect",
		"BillingCity": "San Francisco"
	};
	
	// Create the headers object with Authorization Bearer token
	const headers = {
		'Authorization': `Bearer ${accessToken}`,
		'Content-Type': 'application/json'
	};
	
	// Send a POST request to create a new Account
	fetch(apiEndpoint, {
		method: 'POST',
		headers: headers,
		body: JSON.stringify(newAccountData)  // Send the account data as JSON
	})
	.then(response => response.json())  // Convert response to JSON
	.then(data => {
		// Handle the success response
		console.log('Account created:', data);
		alert('Account Created');
		window.location.reload();
	})
	.catch(error => {
		// Handle any errors
		console.error('Error creating Account:', error);
	});
}
 

</script>
</html>
